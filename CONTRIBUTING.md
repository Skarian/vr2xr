# Contributing to vr2xr

This file is for development and maintenance details.

## Tech Stack

- Android app module: `:app`
- Tracking library module: `:onexr` (from submodule `reference/one-xr/onexr`)
- Media stack: Media3/ExoPlayer
- Rendering: OpenGL ES
- Language/toolchain: Kotlin + AGP, JDK 17

## Requirements

- JDK 17
- Android SDK (`compileSdk = 35`, `minSdk = 33`)
- Git submodules initialized

## Setup

```bash
git submodule update --init --recursive
```

## Build, Lint, Test

```bash
./gradlew :app:assembleDebug
./gradlew :app:lintDebug
./gradlew :app:testDebugUnitTest
```

## Install and Launch (Debug)

```bash
adb install -r app/build/outputs/apk/debug/app-debug.apk
adb shell am start -n com.vr2xr/.app.MainActivity
```

## Diagnostics

Diagnostics are off by default.

Enable diagnostics by either:

- setting `PLAYBACK_DIAGNOSTICS_ENABLED=true` in `app/build.gradle.kts`, or
- setting log property: `adb shell setprop log.tag.PlayerRouting DEBUG`

When enabled, routing logs and on-screen diagnostics are both active.

## Source Ingestion Paths

- `ACTION_VIEW` with `http`, `https`, `content`, `file`
- `ACTION_SEND` with `video/*` stream
- `ACTION_SEND` with `text/plain` URL
- `ACTION_SEND_MULTIPLE` with `video/*` (first stream used)

## Repo Map

- `app/src/main/java/com/vr2xr/app`: activities and app wiring
- `app/src/main/java/com/vr2xr/player`: service, playback coordinator, playback engine
- `app/src/main/java/com/vr2xr/display`: external display controller and route state machine
- `app/src/main/java/com/vr2xr/tracking`: XREAL tracking session integration and pose mapping
- `app/src/main/java/com/vr2xr/render`: SBS renderer
- `app/src/main/java/com/vr2xr/source`: source resolver and intent ingestor
- `app/src/main/java/com/vr2xr/diag`: diagnostics gate and overlay

## Publishing a New Version

This repository publishes from semantic tags only.

- Tag pattern: `v*.*.*`
- GitHub APK workflow: `.github/workflows/release-apk-tag.yml`
- Google Play workflow: `.github/workflows/release-play-tag.yml`
- GitHub note categories: `.github/release.yml`
- Play setup and runbook: `docs/release-play.md`

Per-tag release commands:

```bash
git tag -a v0.0.2 -m "Release v0.0.2"
git push origin v0.0.2
```

Expected results for the same tag:

- GitHub Actions workflow `release-apk-tag.yml` succeeds and publishes `vr2xr.apk`
- GitHub Actions workflow `release-play-tag.yml` succeeds and uploads signed `bundleRelease` to Play `internal` track
- GitHub release notes are autogenerated
- Play release notes are autogenerated from tag delta commits
